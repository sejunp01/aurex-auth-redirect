<!doctype html>
<html lang="en">
<meta charset="utf-8">
<title>Opening AUREX…</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:0;padding:24px;background:#fff}
  .box{max-width:560px;margin:40px auto}
  h1{font-size:22px;margin:0 0 12px}
  p{color:#475569;margin:10px 0}
  a{color:#06b6d4;font-weight:800;text-decoration:none}
  button{padding:12px 16px;border-radius:10px;border:none;background:#06b6d4;color:#fff;font-weight:900}
</style>
<div class="box">
  <h1>Opening AUREX…</h1>
  <p>If the app doesn’t open automatically, tap the button below.</p>
  <p><button id="open">Open in Expo Go</button> <a id="raw" href="#">Open link directly</a></p>
  <p id="dbg" style="color:#64748b;font-weight:700"></p>
</div>
<script>
  function qp(n){return new URL(location.href).searchParams.get(n)||''}
  var deeplink = decodeURIComponent(qp('to')||'');        // exp://.../--/auth
  var code = qp('code');                                  // ?code=... (Supabase v2)
  var err  = qp('error_description') || qp('error');
  var hash = location.hash || '';                         // #access_token=... (old)
  var target = deeplink || '';
  if (code) target += (target.includes('?')?'&':'?') + 'code=' + encodeURIComponent(code);
  if (err)  target += (target.includes('?')?'&':'?') + 'error_description=' + encodeURIComponent(err);
  if (hash && !code) target += hash;                      // 구버전 해시도 지원

  document.getElementById('raw').href = target || '#';
  document.getElementById('dbg').textContent = target?('→ '+target):'No target';

  function go(){
    if(!target) return;
    location.href = target;
    setTimeout(function(){                                 // Android intent fallback
      try{
        var noScheme = target.replace(/^exp:\/\//,'');
        var intent='intent://'+noScheme+'#Intent;scheme=exp;package=host.exp.exponent;S.browser_fallback_url='+encodeURIComponent('https://expo.dev/client')+';end;';
        location.href=intent;
      }catch(e){}
    },500);
  }
  document.getElementById('open').addEventListener('click',go);
  setTimeout(go,300);
</script>
